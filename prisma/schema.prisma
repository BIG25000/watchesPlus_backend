// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum Role {
  USER
  ADMIN
}

enum Movement {
  AUTOMATIC
  QUARTZ
}

enum Gender {
  MALE
  FEMALE
  UNISEX
}

enum InventoryStatus {
  PENDING
  AVAILABLE
  SELLING
  FAILED
  SOLD
}

enum ShippingStatus {
  PENDING
  SUCCESS
  FAILED
  CANCELED
}

enum TransactionType {
  DEPOSIT
  WITHDRAW
  TRANSFER
}

enum OrderStatus {
  PENDING
  SUCCESS
  CANCELED
}

model User {
  id           Int           @id @default(autoincrement())
  firstName    String        @map("first_name")
  lastName     String        @map("last_name")
  email        String        @unique
  password     String
  mobile       String?       @db.VarChar(10)
  status       UserStatus    @default(ACTIVE)
  role         Role          @default(USER)
  profileImage String?       @map("profile_image")
  createdAt    DateTime      @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt    DateTime      @updatedAt @map("updated_at") @db.Timestamp(0)
  royalty      Royalty?
  address      Address?
  wallet       Wallet?
  wishlist     Wishlist[]
  inventory    Inventory[]
  sender       ChatRoom[]    @relation("sender")
  receiver     ChatRoom[]    @relation("receiver")
  fromMessage  ChatMessage[] @relation("senderId")
  toMessage    ChatMessage[] @relation("receiverId")

  @@map("users")
}

model Royalty {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique @map("user_id")
  point     Int      @default(0)
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(0)

  @@map("royalties")
}

model Address {
  id          Int        @id @default(autoincrement())
  userId      Int        @unique @map("user_id")
  user        User       @relation(fields: [userId], references: [id])
  province    String
  district    String
  subDistrict String?    @map("sub_district")
  zipCode     String     @map("zip_code")
  createdAt   DateTime   @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt   DateTime   @updatedAt @map("updated_at") @db.Timestamp(0)
  shipping    Shipping[]

  @@map("address")
}

model Wallet {
  id          Int                 @id @default(autoincrement())
  userId      Int                 @unique @map("user_id")
  user        User                @relation(fields: [userId], references: [id])
  amount      Int                 @default(0)
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")
  buyOrder    BuyOrder[]
  from_wallet TransactionWallet[] @relation("fromWallet")
  to_wallet   TransactionWallet[] @relation("toWallet")

  @@map("wallets")
}

model BuyOrder {
  id                Int                @id @default(autoincrement())
  watchId           Int                @unique @map("watch_id")
  watch             Watch              @relation(fields: [watchId], references: [id])
  walletId          Int                @map("wallet_id")
  wallet            Wallet             @relation(fields: [walletId], references: [id])
  createdAt         DateTime           @default(now()) @map("created_at")
  status            OrderStatus        @default(PENDING)
  price             Int
  TransactionWallet TransactionWallet?

  @@map("buy_orders")
}

model SaleOrder {
  id                Int                @id @default(autoincrement())
  inventoryId       Int                @unique @map("inventory_id")
  inventory         Inventory          @relation(fields: [inventoryId], references: [id])
  price             Int
  createdAt         DateTime           @default(now()) @map("created_at")
  status            OrderStatus        @default(PENDING)
  TransactionWallet TransactionWallet?

  @@map("sale_orders")
}

model Brand {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  watch     Watch[]

  @@map("brands")
}

model Watch {
  id                Int                 @id @default(autoincrement())
  brandId           Int                 @map("brand_id")
  brand             Brand               @relation(fields: [brandId], references: [id])
  modelName         String              @map("model_name")
  movement          Movement            @default(AUTOMATIC)
  gender            Gender              @default(MALE)
  powerReserve      String              @map("power_reserve")
  caseMaterial      String              @map("case_material")
  caseDiameter      String              @map("case_diameter")
  crystal           String
  dial              String
  braceletMaterial  String              @map("bracelet_material")
  braceletColor     String              @map("bracelet_color")
  description       String
  watchImage        String              @map("watch_image")
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  wishlist          Wishlist[]
  inventory         Inventory[]
  buyOrder          BuyOrder[]
  TransactionWallet TransactionWallet[]

  @@map("watches")
}

model Wishlist {
  id        Int      @id @default(autoincrement())
  watchId   Int      @map("watch_id")
  watch     Watch    @relation(fields: [watchId], references: [id])
  userId    Int      @map("user_id")
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("wishlists")
}

model Inventory {
  id        Int             @id @default(autoincrement())
  watchId   Int             @map("watch_id")
  watch     Watch           @relation(fields: [watchId], references: [id])
  userId    Int             @map("user_id")
  user      User            @relation(fields: [userId], references: [id])
  status    InventoryStatus @default(PENDING)
  createdAt DateTime        @default(now()) @map("created_at")
  updatedAt DateTime        @updatedAt @map("updated_at")
  saleOrder SaleOrder?
  shipping  Shipping?

  @@map("inventories")
}

model Shipping {
  id             Int            @id @default(autoincrement())
  addressId      Int            @map("address_id")
  address        Address        @relation(fields: [addressId], references: [id])
  inventoryId    Int            @unique @map("inventory_id")
  inventory      Inventory      @relation(fields: [inventoryId], references: [id])
  trackingNumber String?
  status         ShippingStatus @default(PENDING)
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")

  @@map("shipping")
}

model TransactionWallet {
  id           Int             @id @default(autoincrement())
  fromWalletId Int?            @map("from_wallet_id")
  toWalletId   Int?            @map("to_wallet_id")
  watchId      Int?            @map("watch_id")
  type         TransactionType
  price        Int
  buyOrderId   Int?             @unique @map("buy_order_id")
  saleOrderId  Int?             @unique @map("sale_order_id")
  createdAt    DateTime        @default(now()) @map("created_at")
  watch        Watch?           @relation(fields: [watchId], references: [id])
  buyOrder     BuyOrder?        @relation(fields: [buyOrderId], references: [id])
  saleOrder    SaleOrder?       @relation(fields: [saleOrderId], references: [id])
  fromWallet   Wallet?         @relation("fromWallet", fields: [fromWalletId], references: [id])
  toWallet     Wallet?         @relation("toWallet", fields: [toWalletId], references: [id])

  @@map("transaction_wallets")
}

model ChatRoom {
  id          Int           @id @default(autoincrement())
  userId      Int           @map("user_id")
  adminId     Int           @map("admin_id")
  sender      User          @relation("sender", fields: [userId], references: [id])
  receiver    User          @relation("receiver", fields: [adminId], references: [id])
  createdAt   DateTime      @default(now()) @map("created_at")
  chatMessage ChatMessage[]

  @@map("chat_room")
}

model ChatMessage {
  id         Int      @id @default(autoincrement())
  chatRoomId Int      @map("chatroom_id")
  chatRoom   ChatRoom @relation(fields: [chatRoomId], references: [id])
  senderId   Int      @map("sender_id")
  receiverId Int      @map("receiver_id")
  sender     User     @relation("senderId", fields: [senderId], references: [id])
  receiver   User     @relation("receiverId", fields: [receiverId], references: [id])
  message    String
  createdAt  DateTime @default(now()) @map("created_at")

  @@map("chat_message")
}
